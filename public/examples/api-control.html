<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Editor API Controller</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .log-entry {
            font-family: monospace;
            font-size: 12px;
            border-bottom: 1px solid #eee;
            padding: 4px 0;
        }

        .log-entry:last-child {
            border-bottom: none;
        }

        .log-entry.in {
            color: #2563eb;
        }

        /* Received */
        .log-entry.out {
            color: #059669;
        }

        /* Sent */
    </style>
</head>

<body class="bg-gray-100 p-8 h-screen flex gap-6">

    <!-- Control Panel (Left) -->
    <div class="w-1/3 flex flex-col gap-6 max-h-full overflow-y-auto">
        <div class="bg-white p-6 rounded-lg shadow-sm">
            <h2 class="text-xl font-bold mb-4">Remote Controls</h2>

            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Load Custom Layout</label>
                    <button onclick="loadLayout()"
                        class="w-full bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 transition">
                        Inject "Summer Wedding" Layout
                    </button>
                    <p class="text-xs text-gray-500 mt-1">Replaces current editor content entirely.</p>
                </div>

                <hr class="border-gray-100">

                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Live Update Section</label>
                    <div class="flex gap-2 mb-2">
                        <select id="sectionSelect" class="border rounded px-2 py-1 flex-1 text-sm bg-gray-50">
                            <option value="hero-1">Hero Section</option>
                            <option value="splash-1">Splash Screen</option>
                            <option value="agenda-1">Agenda</option>
                            <option value="gifts-1">Gifts</option>
                        </select>
                    </div>
                    <div class="flex gap-2">
                        <input type="text" id="updateText" placeholder="New Title..."
                            class="border rounded px-3 py-2 flex-1 text-sm">
                        <button onclick="updateSection()"
                            class="bg-indigo-600 text-white px-4 py-2 rounded hover:bg-indigo-700 text-sm">
                            Update
                        </button>
                    </div>
                </div>

                <hr class="border-gray-100">

                <div class="grid grid-cols-2 gap-3">
                    <button onclick="getLayout()"
                        class="bg-gray-800 text-white px-3 py-2 rounded hover:bg-gray-900 text-sm">
                        Get JSON State
                    </button>
                    <button onclick="triggerSave()"
                        class="bg-green-600 text-white px-3 py-2 rounded hover:bg-green-700 text-sm">
                        Trigger Save
                    </button>
                </div>
            </div>
        </div>

        <div class="bg-white p-6 rounded-lg shadow-sm flex-1 flex flex-col min-h-0">
            <div class="flex justify-between items-center mb-2">
                <h2 class="text-sm font-bold uppercase text-gray-500">Event Log</h2>
                <button onclick="clearLog()" class="text-xs text-gray-400 hover:text-red-500">Clear</button>
            </div>
            <div id="logs" class="flex-1 overflow-y-auto bg-gray-50 rounded p-2 border border-gray-200">
                <!-- Logs will appear here -->
            </div>
        </div>
    </div>

    <!-- Editor Iframe (Right) -->
    <div class="w-2/3 bg-white rounded-lg shadow-xl overflow-hidden border border-gray-200">
        <iframe id="editor" src="/" class="w-full h-full border-none" title="Event Editor"></iframe>
    </div>

    <script>
        const iframe = document.getElementById('editor');
        const logs = document.getElementById('logs');
        const editorOrigin = '*'; // In production, replace with specific domain

        // Logger helper
        function log(message, type = 'in') {
            const entry = document.createElement('div');
            entry.className = `log-entry ${type}`;
            const time = new Date().toLocaleTimeString().split(' ')[0];
            const prefix = type === 'out' ? '→ SENT' : '← RECV';

            entry.textContent = `[${time}] ${prefix}: ${JSON.stringify(message)}`;
            logs.prepend(entry);
        }

        function clearLog() {
            logs.innerHTML = '';
        }

        // --- Sending Commands ---

        function sendMessage(type, payload) {
            const msg = { type, payload };
            iframe.contentWindow.postMessage(msg, editorOrigin);
            log(msg, 'out');
        }

        function loadLayout() {
            const demoLayout = {
                id: 'demo-layout-' + Date.now(),
                name: 'Summer Wedding Demo',
                globalStyles: {
                    fontFamilyTitle: 'Playfair Display',
                    fontFamilyBody: 'Lato',
                    primaryColor: '#e11d48', // Rose color
                    secondaryColor: '#fff1f2',
                    backgroundColor: '#fff1f2'
                },
                sections: [
                    {
                        id: 'hero-1',
                        type: 'HeroSection',
                        content: {
                            title: 'Sarah & Mike',
                            subtitle: 'Join us for a summer celebration',
                            backgroundImage: 'https://images.unsplash.com/photo-1519225421980-715cb0202128?auto=format&fit=crop&q=80',
                            date: '2024-07-20'
                        }
                    },
                    {
                        id: 'countdown-1',
                        type: 'CountdownSection',
                        content: {
                            targetDate: '2024-07-20T14:00:00',
                            title: 'Counting Down'
                        }
                    },
                    {
                        id: 'gifts-1',
                        type: 'GiftsSection',
                        content: {
                            title: 'Gift List',
                            description: 'Optional: Thank you for your kindness!',
                            showGifts: true,
                            giftItems: [
                                { id: '1', name: 'Travel Fund', icon: 'plane', description: 'Help us travel.' }
                            ]
                        }
                    }
                ]
            };
            sendMessage('EDITOR_LOAD_LAYOUT', demoLayout);
        }

        function updateSection() {
            const sectionId = document.getElementById('sectionSelect').value;
            const text = document.getElementById('updateText').value;

            if (!text) {
                alert('Please enter some text');
                return;
            }

            sendMessage('EDITOR_UPDATE_SECTION', {
                sectionId,
                content: { title: text } // Simplification: assuming we're updating a title property
            });
        }

        function getLayout() {
            sendMessage('EDITOR_GET_LAYOUT');
        }

        function triggerSave() {
            sendMessage('EDITOR_TRIGGER_SAVE');
        }

        // --- Receiving Events ---

        window.addEventListener('message', (event) => {
            // In production, verify event.origin
            const { type, payload } = event.data;

            // Filter out react-devtools or webpack messages
            if (typeof type === 'string' && type.startsWith('EDITOR_')) {
                log(event.data, 'in');

                if (type === 'EDITOR_READY') {
                    log({ info: 'Editor initialized! API is ready.' }, 'in');
                }
            }
        });
    </script>
</body>

</html>